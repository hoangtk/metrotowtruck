<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        
<!-- Employee Payroll Pay Sheet-->
        <record id="hr_emppay_sheet_filter" model="ir.ui.view">
            <field name="name">hr_emppay_sheet_filter</field>
            <field name="model">hr.emppay.sheet</field>
            <field name="arch" type="xml">
                <search string="Search Payroll">
                    <field name="name" string="Payroll"/>
                    <field name="date_from"/>
                    <field name="date_to"/>
                    <field name="attend_month_id"/>
                    <filter icon="terp-document-new" string="Draft" domain="[('state','=','draft')]" help="Draft Payroll"/>
                    <filter name="done_filter" icon="terp-camera_test" string="Done" domain="[('state','=','close')]" help="Done Payroll"/>
                </search>
            </field>
        </record>

        <record id="hr_emppay_sheet_tree" model="ir.ui.view">
            <field name="name">hr_emppay_sheet_tree</field>
            <field name="model">hr.emppay.sheet</field>
            <field name="arch" type="xml">
                <tree string="Payroll">
                    <field name="name"/>
                    <field name="date_from"/>
                    <field name="date_to"/>
                    <field name="state"/>
                    <field name="attend_month_id"/>
                </tree>
            </field>
        </record>

        <record id="hr_emppay_sheet_form" model="ir.ui.view">
            <field name="name">hr_emppay_sheet_form</field>
            <field name="model">hr.emppay.sheet</field>
            <field name="arch" type="xml">
                <form string="Payroll" version="7.0">
                <header>
                    <button name="add_from_att_report" type="object" states="draft" string="Generate from Attendance Report" groups="account.group_account_invoice"/>
                    <!-- <button name="add_from_att_record" type="object" states="draft" string="Generate from Attendance Records"/> -->
                    <button name="action_verify" type="object" string="Verify" states="draft" class="oe_highlight" groups="account.group_account_invoice"/>
                    <button name="action_pay" type="object" string="Pay" states="verified" class="oe_highlight" groups="account.group_account_invoice"/>
                    <button name="action_draft" type="object" string="Set to Draft" states='verified,paid' groups="account.group_account_manager"/>
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                	<group col="4">
                		<field name="name" readonly="1"/>
	                    <label for= 'date_from' string="Period" class="oe_inline"/>
                		<div>
	                        <field name="date_from" class="oe_inline" attrs="{'readonly':[('state','!=','draft')]}"/>
	                         - 
	                        <field name="date_to" class="oe_inline" attrs="{'readonly':[('state','!=','draft')]}"/>
                		</div>
                		<field name="attend_month_id" readonly="1"/>
						<field name="company_id" groups="base.group_multi_company"/>       
                		<field name="note" Placeholder="Add an internal note..."/>
                	</group>
                    <separator string="Payslips"/>
                    <field name="emppay_ids" attrs="{'readonly':[('state','!=','draft')]}">
		                <tree string="Payslips">                                  		                
		                	<field name="employee_id"/>
							<field name="wage_attend"/>
							<field name="wage_ot"/>
		                	<field name="alw_total"/>
		                	<field name="ded_total"/>
		                	<field name="si_total_personal"/>
		                	<field name="wage_total"/>
		                	<field name="pit"/>
		                	<field name="wage_pay"/>
		                	<field name="state" invisible="1"/>
		                			                	
		                	<!-- <field name="wage"/>
		                	<field name="wage2"/>
		                	
		                	<field name="attend_id" invisible="1"/>
		                	
		                	<field name="days_work"/>
		                	<field name="days_attend"/>
		                	<field name="hours_ot"/>
		                	<field name="hours_ot_we"/>
		                	<field name="hours_ot_holiday"/>
		                	
		                	<field name="days_work2"/>
		                	<field name="days_attend2"/>
		                	<field name="hours_ot2"/>
		                	<field name="hours_ot_we2"/>
		                	<field name="hours_ot_holiday2"/> -->
		                </tree>      
		                <form string="Payslips" version="7.0">
		                    <group col="4">
		                    	<field name="employee_id"/>
		                        <field name="contract_id" 
			                        domain="[('employee_id','=',employee_id),('date_start','&lt;=',date_to),'|',('date_end','&gt;=',date_from),('date_end','=',False)]" 
			                        context="{'default_employee_id': employee_id}"/>
		                        <field name="name"/>
		                    	<field name="note" Placeholder="Add an internal note..."/>
		                        <field name="state" invisible="1"/>
		                    </group>
		                    <notebook>
		                    	<page name="base" string="Payslip">
				                    <group name="attend_wage" string="Attendance">
					                	<field name="attend_id" invisible="1"/>
				                    	<group name="attend">
						                	<field name="days_work"/>
						                	<field name="days_attend"/>
						                	<field name="hours_ot"/>
						                	<field name="hours_ot_we"/>
						                	<field name="hours_ot_holiday"/>
				                    	</group>
				                    	<group name="wage">      
						                	<field name="wage"/>        	
						                	<field name="wage_attend"/>	
						                	<field name="wage_ot"/>
				                    	</group>     	
				                    </group>
				                    <group name="attend_wage2" string="Attendance2">
				                    	<group name="attend2">
						                	<field name="days_work2"/>
						                	<field name="days_attend2"/>
						                	<field name="hours_ot2"/>
						                	<field name="hours_ot_we2"/>
						                	<field name="hours_ot_holiday2"/>
				                    	</group>
				                    	<group name="wage2">
						                	<field name="wage2"/>
						                	<field name="wage_attend2"/>	
						                	<field name="wage_ot2"/>
						                	<field name="wage_bonus2"/>
				                    	</group>
				                    </group>
				                    <group name="wage_detail" string="Wage Detail">
				                    	<group>
						                	<field name="alw_total"/>
						                	<field name="ded_total"/>
						                	<field name="si_total_personal"/>
						                	<field name="si_total_company"/>
				                    	</group>
				                    	<group>
						                	<!-- wage_attend + wage_ot + alw_total - ded_total - si_total_personal -->
						                	<field name="wage_total"/>
						                	<!-- wage_attend + wage_ot + alw_total - si_total_personal -->
						                	<field name="wage_tax"/>
						                	<field name="pit"/>
						                	<!-- wage_total - PIT -->
						                	<field name="wage_pay"/>
				                    	</group>
				                    </group>
		                    	</page>
		                    	<page name="alw" string="Allowance">
					               	<field name="alw_ids" context="{'default_type':'alw'}">
				                       <tree string="Allowance" editable="bottom">
					                    <field name="sequence"/>
					                    <field name="code"/>
					                    <field name="name"/>
					                    <field name="type" invisible="1"/>
					                    <field name="type_calc"/>
					                    <field name="amount" sum="Total"/>
				                       </tree>
					               	</field>
		                    	</page>
		                    	<page name="alw" string="Deduction">
					               	<field name="ded_ids" context="{'default_type':'ded'}">
				                       <tree string="Deduction" editable="bottom">
					                    <field name="sequence"/>
					                    <field name="code"/>
					                    <field name="name"/>
					                    <field name="type" invisible="1"/>
					                    <field name="type_calc"/>
					                    <field name="amount" sum="Total"/>
				                       </tree>
					               	</field>
		                    	</page>
		                    	<page name="alw" string="Social Insurance">
					               	<field name="si_ids">
				                       <tree string="Social Insurance" editable="bottom">
					                    <field name="sequence"/>
					                    <field name="code"/>
					                    <field name="name"/>
					                    <field name="amount_base"/>
					                    <field name="rate_company"/>
					                    <field name="rate_personal"/>
					                    <field name="amount_company" sum="Company Total"/>
					                    <field name="amount_personal" sum="Employee Total"/>
				                       </tree>
					               	</field>
		                    	</page>
		                    </notebook>
		                </form>              	
                    </field>
                </sheet>
                </form>
            </field>
        </record>

        <record id="action_hr_emppay_sheet" model="ir.actions.act_window">
            <field name="name">Payroll</field>
            <field name="res_model">hr.emppay.sheet</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="hr_emppay_sheet_tree"/>
            <field name="search_view_id" ref="hr_emppay_sheet_filter"/>
        </record>
        
        <menuitem action="action_hr_emppay_sheet" id="menu_hr_emppay_sheet" parent="menu_hr_root_emppay" sequence="1"/>
        
<!-- Employee Payroll Pay Slip-->
        
        <record id="view_hr_emppay_list" model="ir.ui.view">
            <field name="name">view_hr_emppay_list</field>
            <field name="model">hr.emppay</field>
            <field name="arch" type="xml">
                <tree colors="gray:state == 'cancel'" string="Payslips"> 
                    <field name="emppay_sheet_id"/>
                	<field name="name"/>
                	<field name="employee_id"/>
                	<field name="date_from"/>
                	<field name="date_to"/>
                	
                	<field name="attend_id" invisible="1"/>
                	
                	<field name="wage"/>
                	<!-- <field name="days_work"/> -->
                	<field name="days_attend"/>
					<field name="wage_attend"/>
                	<!-- <field name="hours_ot"/>
                	<field name="hours_ot_we"/>
                	<field name="hours_ot_holiday"/> -->
					<field name="wage_ot"/>
                	<field name="alw_total"/>
                	<field name="ded_total"/>
                	<field name="si_total_personal"/>
                	<field name="wage_total"/>
                	<field name="pit"/>
                	<field name="wage_pay"/>
                	
                	<field name="wage2"/>
                	<!-- <field name="days_work2"/>
                	<field name="days_attend2"/>
				    <field name="wage_attend2"/>	
                	<field name="hours_ot2"/>
                	<field name="hours_ot_we2"/>
                	<field name="hours_ot_holiday2"/> -->
                	<field name="wage_ot2"/>
                	<field name="wage_bonus2"/>
		                	
                	<field name="state"/>
					<field name="company_id" groups="base.group_multi_company"/>      
                </tree>
            </field>
        </record>

        <record id="view_hr_emppay_form" model="ir.ui.view">
            <field name="name">view_hr_emppay_form</field>
            <field name="model">hr.emppay</field>
            <field name="arch" type="xml">
                <form string="Payslip" version="7.0">
                <header>
                    <button name="action_verify" type="object" string="Verify" states="draft" class="oe_highlight" groups="account.group_account_invoice"/>
                    <button name="action_pay" type="object" string="Pay" states="verified" class="oe_highlight" groups="account.group_account_invoice"/>
                    <button name="action_draft" type="object" string="Set to Draft" states='verified,paid' groups="account.group_account_manager"/>
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                	<div>
                		<h1>
                			<label for="employee_id" class="oe_edit_only"/>
                    		<field name="employee_id"/>
                		</h1>
                	</div>
                    <group col="4">
                        <field name="contract_id" 
	                        domain="[('employee_id','=',employee_id),('date_start','&lt;=',date_to),'|',('date_end','&gt;=',date_from),('date_end','=',False)]" 
	                        context="{'default_employee_id': employee_id}"/>
	                    <label for="date_from" string="Dates"/>
	                    <div>
						    <field name="date_from" class="oe_inline"/> -
						    <field name="date_to" class="oe_inline"/>  
	                    </div>	
                        <field name="name"/>
                        <field name="company_id" groups="base.group_multi_company"/>
                        <field name="emppay_sheet_id" readonly="1"/>
                    	<field name="note" Placeholder="Add an internal note..."/>
                    </group>
                    <notebook>
                    	<page name="base" string="Payslip">
		                    <group name="attend_wage" string="Attendance">
			                	<field name="attend_id" invisible="1"/>
		                    	<group name="attend">
				                	<field name="days_work"/>
				                	<field name="days_attend"/>
				                	<field name="hours_ot"/>
				                	<field name="hours_ot_we"/>
				                	<field name="hours_ot_holiday"/>
		                    	</group>
		                    	<group name="wage">      
				                	<field name="wage"/>        	
				                	<field name="wage_attend"/>	
				                	<field name="wage_ot"/>
		                    	</group>     	
		                    </group>
		                    <group name="attend_wage2" string="Attendance2">
		                    	<group name="attend2">
				                	<field name="days_work2"/>
				                	<field name="days_attend2"/>
				                	<field name="hours_ot2"/>
				                	<field name="hours_ot_we2"/>
				                	<field name="hours_ot_holiday2"/>
		                    	</group>
		                    	<group name="wage2">
				                	<field name="wage2"/>
				                	<field name="wage_attend2"/>	
				                	<field name="wage_ot2"/>
				                	<field name="wage_bonus2"/>
		                    	</group>
		                    </group>
		                    <group name="wage_detail" string="Wage Detail">
		                    	<group>
				                	<field name="alw_total"/>
				                	<field name="ded_total"/>
				                	<field name="si_total_personal"/>
				                	<field name="si_total_company"/>
		                    	</group>
		                    	<group>
				                	<!-- wage_attend + wage_ot + alw_total - ded_total - si_total_personal -->
				                	<field name="wage_total"/>
				                	<!-- wage_attend + wage_ot + alw_total - si_total_personal -->
				                	<field name="wage_tax"/>
				                	<field name="pit"/>
				                	<!-- wage_total - PIT -->
				                	<field name="wage_pay"/>
		                    	</group>
		                    </group>		                    
                    	</page>
                    	<page name="alw" string="Allowance">
			               	<field name="alw_ids" context="{'default_type':'alw'}">
		                       <tree string="Allowance" editable="bottom">
			                    <field name="sequence"/>
			                    <field name="code"/>
			                    <field name="name"/>
			                    <field name="type" invisible="1"/>
			                    <field name="type_calc"/>
			                    <field name="amount" sum="Total"/>
		                       </tree>
			               	</field>
                    	</page>
                    	<page name="alw" string="Deduction">
			               	<field name="ded_ids" context="{'default_type':'ded'}">
		                       <tree string="Deduction" editable="bottom">
			                    <field name="sequence"/>
			                    <field name="code"/>
			                    <field name="name"/>
			                    <field name="type" invisible="1"/>
			                    <field name="type_calc"/>
			                    <field name="amount" sum="Total"/>
		                       </tree>
			               	</field>
                    	</page>
                    	<page name="alw" string="Social Insurance">
			               	<field name="si_ids">
		                       <tree string="Social Insurance" editable="bottom">
			                    <field name="sequence"/>
			                    <field name="code"/>
			                    <field name="name"/>
			                    <field name="amount_base"/>
			                    <field name="rate_company"/>
			                    <field name="rate_personal"/>
			                    <field name="amount_company" sum="Company Total"/>
			                    <field name="amount_personal" sum="Employee Total"/>
		                       </tree>
			               	</field>
                    	</page>
                    </notebook>
                </sheet>
                </form>
            </field>
        </record>

        <record id="view_hr_emppay_search" model="ir.ui.view">
            <field name="name">view_hr_emppay_search</field>
            <field name="model">hr.emppay</field>
            <field name="arch" type="xml">
                <search string="Search Payslip">
                    <field name="name" string="Payslips" filter_domain="['|',('name','ilike',self),('number','ilike',self)]"/>
                    <field name="date_from"/>
                    <filter icon="terp-document-new" string="Draft" domain="[('state','=','draft')]" help="Draft Slip"/>
                    <filter icon="terp-camera_test" string="Verified" domain="[('state','=','verified')]" help="Verified Slip"/>
                    <filter icon="terp-camera_test" string="Paid" domain="[('state','=','paid')]" help="Paid Slip"/>
                    <field name="employee_id"/>
                    <field name="emppay_sheet_id"/>
                    <group expand="0" string="Group By...">
                        <filter string="Employees" icon="terp-personal" name="employee_id" context="{'group_by':'employee_id'}"/>
                        <filter string="Payroll" name="emppay_sheet_id" icon="terp-folder-orange" context="{'group_by':'emppay_sheet_id'}"/>
                        <filter string="Companies" name="company_id" groups="base.group_multi_company" icon="terp-go-home" context="{'group_by':'company_id'}"/>
                        <filter string="States" name="state" icon="terp-stock_effects-object-colorize" context="{'group_by':'state'}"/>
                    </group>
                </search>
            </field>
        </record>
        
        <record id="action_hr_emppay" model="ir.actions.act_window">
            <field name="name">Payslips</field>
            <field name="res_model">hr.emppay</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_hr_emppay_list"/>
            <field name="search_view_id" ref="view_hr_emppay_search"/>
        </record>

        <menuitem action="action_hr_emppay" id="menu_hr_emppay" parent="menu_hr_root_emppay" sequence="2"/>                

<!-- 
1.Add button to genrate payroll from attendance report
2.Show the related payrolls in attendance report
 -->    
        <record id="hr_rpt_attend_month_view_emppay" model="ir.ui.view">
            <field name="name">hr_rpt_attend_month_view_emppay</field>
            <field name="model">hr.rpt.attend.month</field>
            <field name="inherit_id" ref="hr_rpt_attend_month_view"/>
            <field name="arch" type="xml">
            <data>
                <button name="save_pdf" position="after">
                	<button name="new_payroll" string="Generate Payroll" type="object" states="done"/>
                	<field name="id" invisible="1"/>
                	<button name="%(action_hr_emppay_sheet)d" string="Payrolls" type="action" states="done"
                		context="{'search_default_attend_month_id': id}"/>
                </button>
                <page name="employee" position="after">
                	<page name="payroll" string="Payrolls">
                		<field name="emppay_sheet_ids"/>
                	</page>
                </page>
            </data>
            </field>
        </record>                
    </data>
</openerp>

